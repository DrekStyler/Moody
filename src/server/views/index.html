{% extends "_base.html" %}

{% block title %}{% endblock %}

{% block content %}

  <div class="row">
    <div class="col-md-9">
      {% if player %}
        {% include "youtubePlayer.html" %}
      {% else %}
        {% include "carousel.html" %}
      {% endif %}
    </div>
    <div class="col-md-3">
    </div>
  </div>

  <div class="container-fluid">
    <h1>Moody.</h1>
    <h1>{{message}}</h1>
    <h2>If you don't like the music, change your tone.</h2>
    <button class="btn-success" onclick="timingQueue(this);">record</button>
    <div class="linkDiv" id="linkDiv"></div>
    <div class="row">
      <button id="stop-btn">Testing</button>
				<div class="offset3 span3 text-center">
          <button class="btn" ng-click="startRecording()" ng-disabled="recording">
            <i class="icon-circle" ng-class="recordButtonStyle"></i>&nbsp;Start recording
          </button>
        </div>
				  <div class="span3 text-center">
            <button class="btn" ng-click="stopRecording()" ng-disabled="!recording">
              <i class="icon-download-alt"></i>&nbsp;Stop recording
            </button>
        </div>
			</div>
			<div class="row">
				<div class="span12 text-center" ng-show="recording">
					<span class="label label-important">Recording...</label>
				</div>
			</div>
  </div>
  <button type="submit" class="btn btn-warning" id="speechSubmit">Analyze Speech!</button>

  {% include "addSong.html" %}
  {% include "flacrecorder.html" %}
{% endblock %}
{% block scripts %}
  <script type="text/javascript" src="/js/return-recording.js"></script>
  <script src="../js/addSongToUser.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.6/socket.io.min.js"></script>
  <script src="/js/sockets/socket.io-stream.js"></script>
  <script>
  $(function() {
    var socket = io.connect('/blob-stream');

    $('#linkDiv').change(function(e) {
      console.log(e.target);
      var file = e.target.files[0];
      var stream = ss.createStream();

      // upload a file to the server.
      ss(socket).emit('file', stream, {size: file.size});
      ss.createBlobReadStream(file).pipe(stream);

      var blobStream = ss.createBlobReadStream(file);
      var size = 0;

      blobStream.on('data', function(chunk) {
        size += chunk.length;
        console.log(Math.floor(size / file.size * 100) + '%');
        // -> e.g. '42%'
      });

      blobStream.pipe(stream);
    });
  });


  </script>

{% endblock %}
